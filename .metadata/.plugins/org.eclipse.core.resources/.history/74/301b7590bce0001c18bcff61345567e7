package com.example.onlineApiTest;

import java.io.IOException;
import java.text.ParseException;

import org.junit.Assert;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.ResponseEntity;
import org.springframework.web.client.RestTemplate;
import org.testng.annotations.BeforeTest;
import org.testng.annotations.Test;
import org.testng.log4testng.Logger;

public class CrudOnlineApi {
	private String responsebody;
	final static Logger logger = Logger.getLogger(TestNg.class);
	private RestTemplate restTemplate;
	private ResponseEntity<String> response;
	
	@BeforeTest
	void beforeTest() throws IOException, ParseException {
		logger.info("Setting up prerequisite for test execution");
		logger.info("Creating RestTemplate object before tests");
		this.restTemplate = new RestTemplate();
	}
	
	@Test
	public void addValues() {
		String addURI = "https://crudcrud.com/api/202c29609c8a418d9c5269bb517e6c6f";
		//logger.info("Get URL :" + addURI);
	//	System.out.println("addURI :" + addURI);
		
		HttpHeaders headers = new HttpHeaders();
		headers.add("Accept", "application/json");
		headers.add("Content-Type", "application/json");

	//	logger.info("Add URL :" + addURI);
		String jsonBody = "{\"name\":\"zozo100\",\"age\":\"23\",\"colour\":\"red\"}";
		//System.out.println("\n\n" + jsonBody);
		addURI = "https://crudcrud.com/api/202c29609c8a418d9c5269bb517e6c6f" + "/jsonBody";
		HttpEntity<String> entity = new HttpEntity<String>(jsonBody, headers);

		response = this.restTemplate.postForEntity(addURI, entity, String.class);
		System.out.println("response :" + response);
		
		
	}
	
	@Test(dependsOnMethods = "addValues", enabled = true)
	public void getValues() {
		String getURI = "https://crudcrud.com/api/2c75d0e8d07f493fa7e343ac3e3a4a54";
		logger.info("Get URL :" + getURI);
		//System.out.println("getURI :" + getURI);
		
		ResponseEntity<String> response= restTemplate.getForEntity(getURI, String.class);
		//System.out.println("response :" + response);
		responsebody = response.getBody().toString();
		Assert.assertTrue(responsebody.contains(zozo100));
	}
}
